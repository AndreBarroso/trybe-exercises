use ('erp');


db.clientes.aggregate([
  {
    $lookup: {
      from: 'vendas',
      localField: 'clienteId',
      foreignField: 'clienteId',
      as: 'compra'
    }
  },
  {
    $project: {
      _id: 0,
      "uf": "$endereco.uf",
      "totalVendas": {$size: "$compra.itens"}
    }
  },
  {
    $sort: {totalVendas: -1}
  }
]);
